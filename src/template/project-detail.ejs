<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <title>
    <%= project.nombre %>
  </title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/app.css" rel="stylesheet" />
  <link href="/css/BgAnimation.css" rel="stylesheet" />
  <script src="/js/comments.js" defer></script>
</head>

<body>
  <div className="bg-animation">
    <div id="stars"></div>
  </div>
  <%- include('menu') %>

    <main class="container py-4">
      <% if (project.imagen_portada) { %>
        <div class="detail-cover-wrap mb-3">
          <img src="<%= project.imagen_portada %>" class="detail-cover" alt="<%= project.nombre %>">
        </div>
        <% } %>

          <div class="row g-4 align-items-start">
            <!-- IZQUIERDA -->
            <div class="col-lg-7">
              <div class="d-flex align-items-center gap-3 mb-2">
                <img src="<%= project.imagen_logo %>" class="detail-logo" alt="<%= project.nombre %>"
                  onerror="this.onerror=null; this.src='/img/placeholder-logo.png';">
                <div>
                  <a class="badge-materia link-unstyled"
                    href="/courses/<%= encodeURIComponent(project.materia || 'Proyecto Integrador') %>">
                    <%= project.materia || 'Proyecto Integrador' %>
                  </a>

                  <h1 class="mb-0">
                    <%= project.nombre %>
                  </h1>
                  <div class="meta-line">
                    <% if (project.fecha) { %>
                      <span class="meta-chip">Presentado el <%= project.fecha %></span>
                      <% } %>
                        <span class="meta-chip">
                          <%= (project.integrantes || []).length %> integrantes
                        </span>
                        <% if (project.despliegue) { %>
                          <a class="meta-chip link text-decoration-none" href="<%= project.despliegue %>"
                            target="_blank" rel="noopener">
                            Despliegue disponible
                          </a>
                          <% } %>
                  </div>
                </div>
              </div>

              <section class="mt-3">
                <h5>Descripción</h5>
                <p>
                  <%= project.descripcion || project.resumen %>
                </p>
                <% if (project.despliegue) { %>
                  <a href="<%= project.despliegue %>" target="_blank" rel="noopener" class="btn btn-primary mt-2">Ver
                    despliegue</a>
                  <% } %>
              </section>
              <% if (project.favoritos && project.favoritos.length) { %>
                <section class="mt-4">
                  <h5>Favorito(s) del docente</h5>
                  <div class="row g-3">
                    <% project.favoritos.forEach(f=> { %>
                      <div class="col-md-6">
                        <div class="card bg-dark text-light border-secondary">
                          <div class="card-body">
                            <div class="d-flex align-items-center gap-2 mb-2">
                              <span class="badge bg-danger">Favorito ❤️</span>
                              <strong>
                                <%= f.docente %>
                              </strong>
                            </div>

                            <% if (f.audio) { %>
                              <audio class="fav-audio w-100 mb-2" controls preload="metadata">
                                <source src="<%= f.audio %>" type="audio/mpeg">
                                <source src="<%= f.audio %>" type="audio/ogg">
                                Tu navegador no soporta audio.
                              </audio>
                              <% } %>

                                <p class="mb-0">
                                  <%= (typeof f.comentario==='string' && f.comentario.trim()) ? f.comentario : (f.audio
                                    ? 'Comentario en audio.' : 'Sin comentario.' ) %>
                                </p>
                          </div>
                        </div>
                      </div>
                      <% }) %>
                  </div>
                </section>

                <% } %>



            </div>

            <!-- DERECHA -->
            <div class="col-lg-5">
              <div class="card integrantes">
                <div class="card-header">Integrantes (<%= (project.integrantes || []).length %>)</div>
                <ul class="list-group list-group-flush">
                  <% (project.integrantes || []).forEach(n=> { %>
                    <li class="list-group-item bg-dark text-light">
                      <%= n %>
                    </li>
                    <% }) %>
                </ul>
              </div>
            </div>
          </div>
          <section class="mt-4" data-comments-root data-project-id="<%= project.id %>">
            <div class="card comment-card">
              <div class="card-header d-flex justify-content-between align-items-center">
                <strong>Comentarios</strong>
                <small class="text-muted"><span id="c-count">0</span> comentario(s)</small>
              </div>
              <div class="card-body">
                <ul id="c-list" class="list-unstyled mb-3"></ul>

                <form id="c-form" class="d-flex gap-2" autocomplete="off">
                  <img id="c-avatar-preview" src="/img/user.png" alt="Avatar" class="c-avatar me-1" />
                  <input id="c-input" type="text" class="form-control"
                    placeholder="Escribe un comentario y presiona Enter…" maxlength="400" />
                  <button class="btn btn-primary" type="submit">Enviar</button>
                </form>
                <small class="text-muted d-block mt-1">Los comentarios son anónimos.</small>
              </div>
            </div>
          </section>

          <div class="mt-4">
            <a class="btn btn-secondary" href="/projects/v1.0/list">Volver</a>
          </div>
    </main>
</body>

</html>